var P=Object.defineProperty;var h=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var F=(e,o,u)=>o in e?P(e,o,{enumerable:!0,configurable:!0,writable:!0,value:u}):e[o]=u,E=(e,o)=>{for(var u in o||(o={}))T.call(o,u)&&F(e,u,o[u]);if(h)for(var u of h(o))I.call(o,u)&&F(e,u,o[u]);return e};var m=(e,o,u)=>new Promise((r,t)=>{var c=s=>{try{i(u.next(s))}catch(d){t(d)}},a=s=>{try{i(u.throw(s))}catch(d){t(d)}},i=s=>s.done?r(s.value):Promise.resolve(s.value).then(c,a);i((u=u.apply(e,o)).next())});import{B as k,u as A}from"./useForm.fc0a4233.js";import{dy as v,bR as _,eS as V,a as M,b as R,i as q,B as x,O as N,D as w,r as C,o as O,y as $,z as G,f as L,A as U,eT as z,eU as W,bW as j}from"./index.7e254f9c.js";import{B as H,u as J}from"./index.07ead0fe.js";import{c as K}from"./system.cbda3799.js";const b=e=>+e==0,n=e=>+e==2,ae=[{title:"\u83DC\u5355\u540D\u79F0",dataIndex:"name",width:200,align:"left"},{title:"\u56FE\u6807",dataIndex:"icon",width:50,customRender:({record:e})=>v(_,{icon:e.icon})},{title:"\u7EC4\u4EF6",dataIndex:"component",align:"left",width:180},{title:"\u8DEF\u5F84",dataIndex:"url",align:"left",width:150},{title:"\u6392\u5E8F",dataIndex:"sortNo",width:50}],Q=[{label:"id",field:"id",component:"Input",show:!1},{field:"menuType",label:"\u83DC\u5355\u7C7B\u578B",component:"RadioGroup",defaultValue:0,componentProps:({formActionType:e})=>({options:[{label:"\u4E00\u7EA7\u83DC\u5355",value:0},{label:"\u5B50\u83DC\u5355",value:1},{label:"\u6309\u94AE/\u6743\u9650",value:2}],onChange:o=>{const{updateSchema:u,clearValidate:r}=e,t=n(o)?"\u6309\u94AE/\u6743\u9650":"\u83DC\u5355\u540D\u79F0";r(),u([{field:"name",label:t},{field:"url",required:!n(o)}])}}),colProps:{lg:24,md:24}},{field:"name",label:"\u83DC\u5355\u540D\u79F0",component:"Input",required:!0,colProps:{lg:24,md:24}},{field:"parentId",label:"\u4E0A\u7EA7\u83DC\u5355",component:"TreeSelect",required:!0,componentProps:{replaceFields:{title:"name",key:"id",value:"id"},dropdownStyle:{maxHeight:"50vh"},getPopupContainer:e=>e.parentNode},ifShow:({values:e})=>!b(e.menuType),colProps:{lg:24,md:24}},{field:"url",label:"\u8BBF\u95EE\u8DEF\u5F84",component:"Input",required:!0,ifShow:({values:e})=>!((e.component==="sys/iframe/FrameBlank"||e.component==="IFRAME")&&e.internalOrExternal),colProps:{lg:24,md:24}},{field:"component",label:"\u524D\u7AEF\u7EC4\u4EF6",component:"Input",componentProps:{placeholder:"\u8BF7\u8F93\u5165\u524D\u7AEF\u7EC4\u4EF6"},required:!0,ifShow:({values:e})=>!n(e.menuType),colProps:{lg:24,md:24}},{field:"frameSrc",label:"Iframe\u5730\u5740",component:"Input",rules:[{required:!0,message:"\u8BF7\u8F93\u5165Iframe\u5730\u5740"}],ifShow:({values:e})=>!n(e.menuType)&&(e.component==="sys/iframe/FrameBlank"||e.component==="IFRAME"),colProps:{lg:24,md:24}},{field:"redirect",label:"\u9ED8\u8BA4\u8DF3\u8F6C\u5730\u5740",component:"Input",ifShow:({values:e})=>b(e.menuType),colProps:{lg:24,md:24}},{field:"perms",label:"\u6388\u6743\u6807\u8BC6",component:"Input",ifShow:({values:e})=>n(e.menuType),colProps:{lg:24,md:24},dynamicRules:({model:e})=>[{required:!1,validator:(o,u)=>new Promise((r,t)=>{const c={tableName:"sys_permission",fieldName:"perms",fieldVal:u,dataId:e.id};V(c).then(a=>{a.success?r():t(a.message||"\u6821\u9A8C\u5931\u8D25")}).catch(a=>{t(a.message||"\u6821\u9A8C\u5931\u8D25")})})}]},{field:"permsType",label:"\u6388\u6743\u7B56\u7565",component:"RadioGroup",defaultValue:"1",helpMessage:["\u53EF\u89C1/\u53EF\u8BBF\u95EE(\u6388\u6743\u540E\u53EF\u89C1/\u53EF\u8BBF\u95EE)","\u53EF\u7F16\u8F91(\u672A\u6388\u6743\u65F6\u7981\u7528)"],componentProps:{options:[{label:"\u53EF\u89C1/\u53EF\u8BBF\u95EE",value:"1"},{label:"\u53EF\u7F16\u8F91",value:"2"}]},ifShow:({values:e})=>n(e.menuType),colProps:{lg:24,md:24}},{field:"status",label:"\u72B6\u6001",component:"RadioGroup",defaultValue:"1",componentProps:{options:[{label:"\u6709\u6548",value:"1"},{label:"\u65E0\u6548",value:"0"}]},ifShow:({values:e})=>n(e.menuType)},{field:"icon",label:"\u83DC\u5355\u56FE\u6807",component:"IconPicker",ifShow:({values:e})=>!n(e.menuType)},{field:"sortNo",label:"\u6392\u5E8F",component:"InputNumber",defaultValue:1,ifShow:({values:e})=>!n(e.menuType)},{field:"route",label:"\u662F\u5426\u8DEF\u7531\u83DC\u5355",component:"Switch",defaultValue:!0,componentProps:{checkedChildren:"\u662F",unCheckedChildren:"\u5426"},ifShow:({values:e})=>!n(e.menuType)},{field:"hidden",label:"\u9690\u85CF\u8DEF\u7531",component:"Switch",defaultValue:0,componentProps:{checkedChildren:"\u662F",unCheckedChildren:"\u5426"},ifShow:({values:e})=>!n(e.menuType)},{field:"hideTab",label:"\u9690\u85CFTab",component:"Switch",defaultValue:0,componentProps:{checkedChildren:"\u662F",unCheckedChildren:"\u5426"},ifShow:({values:e})=>!n(e.menuType)},{field:"keepAlive",label:"\u662F\u5426\u7F13\u5B58\u8DEF\u7531",component:"Switch",defaultValue:!1,componentProps:{checkedChildren:"\u662F",unCheckedChildren:"\u5426"},ifShow:({values:e})=>!n(e.menuType)},{field:"alwaysShow",label:"\u805A\u5408\u8DEF\u7531",component:"Switch",defaultValue:!1,componentProps:{checkedChildren:"\u662F",unCheckedChildren:"\u5426"},ifShow:({values:e})=>!n(e.menuType)},{field:"internalOrExternal",label:"\u6253\u5F00\u65B9\u5F0F",component:"Switch",defaultValue:!1,componentProps:{checkedChildren:"\u5916\u90E8",unCheckedChildren:"\u5185\u90E8"},ifShow:({values:e})=>!n(e.menuType)}],X=R({name:"MenuDrawer",components:{BasicDrawer:H,BasicForm:k},emits:["success","register"],setup(e,{emit:o}){const u=q(!0),{createMessage:r}=j(),{t}=x(),[c,{resetFields:a,setFieldsValue:i,updateSchema:s,validate:d}]=A({labelWidth:100,schemas:Q,showActionButtonGroup:!1,baseColProps:{lg:12,md:24}}),[g,{setDrawerProps:p,closeDrawer:f}]=J(l=>m(this,null,function*(){a(),p({confirmLoading:!1}),u.value=!!(l!=null&&l.isUpdate),w(u)&&i(E({},l.record));const B=(yield K()).filter(y=>y.menuType===0);s({field:"parentId",componentProps:{treeData:B}})})),D=N(()=>w(u)?"\u7F16\u8F91\u83DC\u5355":"\u65B0\u589E\u83DC\u5355");function S(){return m(this,null,function*(){try{p({confirmLoading:!0});const l=yield d();l.status=l.status===void 0?1:l.status,u.value?z(l).then(()=>{r.success({content:t("common.saveSuccess"),duration:1}),f(),o("success")}):W(l).then(()=>{r.success({content:t("common.saveSuccess"),duration:1}),f(),o("success")})}finally{p({confirmLoading:!1})}})}return{registerDrawer:g,registerForm:c,getTitle:D,handleSubmit:S}}});function Y(e,o,u,r,t,c){const a=C("BasicForm"),i=C("BasicDrawer");return O(),$(i,U(e.$attrs,{onRegister:e.registerDrawer,showFooter:"",title:e.getTitle,width:"30%",onOk:e.handleSubmit}),{default:G(()=>[L(a,{onRegister:e.registerForm},null,8,["onRegister"])]),_:1},16,["onRegister","title","onOk"])}var Z=M(X,[["render",Y]]),le=Object.freeze(Object.defineProperty({__proto__:null,default:Z},Symbol.toStringTag,{value:"Module"}));export{Z as M,le as a,ae as c};
